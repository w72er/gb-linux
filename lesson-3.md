# Пользователи и управление пользователями

План урока:
* Типы пользователей.
* Управление пользователями и группами.
* Утилиты sudo, su.

## Типы пользователей

Пользователь - ключевое понятие для организации доступа. Содержит 2 атрибута:
UID - отличие одного пользователя от другого врутри одной системы.
GID - идентификатор основной группы пользователя. При создании пользователя создается одноименная группа, и пользователь получает ее как основную.

Три группы пользователей:
* суперпользователь (root) - имеет доступ ко всему в системе.
* демоны (псевдопользователи, пользователи служб) - учетные записи используются процессами. Для того что бы демонам можно запускаться, взаимодействовать с другими пользователями. Не могут входить в оболочку.
* Пользователи - учетные записи создаются для людей. Такой пользователь получает оболочку, чтобы работать с системой.

Когда задача требует получения информации с нескольких серверов, для подключения к нескольким серверам нужна учетная запись, даже для скрипта.

Система понимает, что пользователь - суперпользователь, по нулевым UID, GID.
Все изменения в системе выполняются под учетной записью суперпользователя:
* Изменение конфигурации
* Запуск системных служб
* Подключение устройств

sshd - такие службы запускаются под учетками одноименных пользователей. Сначала такие службы запускались от рута, но это не безопасно, так как имеют доступ рута.

Обычные пользователи создаются суперадминистратором.
* ldap - пользователь может создаваться на уровне сети.
* локально на компьютере

Видеть информацию о пользователях и группах:
/etc/passwd - список учеток всех пользователей до текущего момента
/etc/group - о всех группах, и пользователях входящих в эти группы
/etc/shadow - пароли.

### /etc/passwd

Изначально пароли хранились в /etc/password/ и был доступен всем пользователям, и можно было перебирать хэши, так что пароли перенесены в другой файл, и доступен для чтения не всем.

```text
a@gb-udt:~$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
```

username:password:uid:gid:comment:home-directory:
* где находится папка запускаемого демона.

* system users nologin or /bin/false
* /bin/bash root or common user

* system uid [0: 1000)
* обычные пользователи [1000, +)

### /etc/group

```text
a@gb-udt:~$ cat /etc/group
root:x:0:
daemon:x:1:
adm:x:4:syslog,a
tty:x:5:syslog
```

group_name:password-for-group:group_id:users-in-group

password-for-group используется на практике редко.

### /etc/shadow

```text

a@gb-udt:~$ sudo cat /etc/shadow
[sudo] password for a:
root:!:18777:0:99999:7:::
daemon:*:18667:0:99999:7:::
bin:*:18667:0:99999:7:::
sys:*:18667:0:99999:7:::
a:$6$3sbjTzQbTucj1Ugx$NeuUCKBvg7S9PRMqQ6jzBJRI8vRRQtY1sVzDOHnf0z3419Y3Zdviwo0lFI2jHe9xKCpcNZGoGoUbDTJOcfSSm0:18777:0:99999:7:::
```

У root нет пароля об этом говорит "!", значит мы не можем под этим пользователем залогиниться. Очень легко перепутать на каком сервере выполнять команду, поэтому входим не под системным администратором.
У псевдопользователей (службы) нет пароля, то есть "*".
name:password:специальные_настройки

Если допустить ошибку в файлах, то никто-не сможет залогиниться, поэтому применяются для редактирования утилиты.

```text
a@gb-udt:~$ id
uid=1000(a) gid=1000(a) groups=1000(a),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),120(lpadmin),131(lxd),132(sambashare)
```

Процессы не общаются через интерактивную оболочку. Интерактивное взаимодействие с операционной системой - `bash`.
Псевдопользователи не могут войти, т.к. если бы могли, то через них можно войти, используя пароль, что повышает риск в безопасности.


## Управление пользователями и группами.

### Добавить пользователя

```text
sudo useradd -m -s /bin/bash user1 
# -m автоматически создать домашнюю папку в /home/
# -s /bin/bash - оболочка пользователя
# user1 - имя пользователя


# пароль у пользователя "!", значит мы не сможем войти под ним, так как не указан пароль.
```

```text
sudo adduser user2

# пароль имеется и он может войти в систему интерактивно.
```

### Создание групп

```text
sudo groupadd team1
# аналогично работает addgroup
sudo addgroup team2
```

### passwd

`passwd username` изменит пароль пользователя.
`passwd` без имени, изменит пароль текущего пользователя.

`usermod` - изменяет атрибуты пользователя.


Если пользователя добавить в группу `sudo`, то пользователь сможет выполнять команду `sudo`.
Добавить пользователя user1 в группу `sudo`

```text
sudo usermode -a
# -a append
# -G добавляем в дополнительную группу

cat /etc/group

sudo:x:27:user,user1
```

## Утилиты sudo, su.

### su
su - команда позволяет в текущей сессией перейти в другого пользователя. Созданно для временного перехода в другого пользователя. Переход осуществляется быстро.

у нашего root нет пароля, то и `su` без имени не сработает.

sudo пароль текущего пользователя.

хотя мы и переключились, мы по прежнему работаем в окружении старого пользователя и старой домашней директории
`su - user1` - c "-" исправит эту ситуации.
`exit` - выход из временной сессии.

### sudo

`sudo` - использует настройки из файла /etc/sudoers, то есть описаны возможности.
```text
sudo cat /etc/sudoers
root ALL=(ALL:ALL) ALL # использовать судо на всех хостах. =( Пользователь рут может вызывать под любыми пользователями. ":" Пользователь рут может выпольнить действие под любой группой.) И может выполнить любую команду.
user1 ALL=adduser # может добавлять пользователя.
%admin ...
%sudo ...
```

`sudo edit`, `sudo li`

`sudoedit /etc/sudoers` - проверит корректность новых настроек.

`sudo userdel -r user2` `-r` удалить почту и рабочую группу.

`sudo groupdel team2`

При наборе команд вы могли заметить автодополнение:
* путей
* набора команд

`su` `2*tab` покажутся подсказки.

`history` мы можем ввести команду по ее номеру в `history`, например `!40`
стрелки вверх и вниз ходим по истории.
`^r` - поиск по history как в текстовом файле.

### Владелец и группа владельца

Любой каталог или файл имеет владельца или группу владельца.

`ls -l`
```text
touch file1.txt
теперь нам надо поменять владельца данного пользователя файла
теперь воспользуемся chown
sudo chown user1:team1 file1.txt
так же мы можем поменять только группу
sudo chgrp user1 file1.txt
```

Если хотим изменить рекурсивно, то нужно изменять с помощью ключа.
`-R`:
```text
sudo chown -R user1:user1 lesson3/
```

1. Создать пользователя в ручном режиме, мы можем редактировать пользователя через редактор. Задание c. оставляю на усмотрение.
вместо с помощью скрипта adduser.
2.
b. usermod -g -маленькое
Получайте самостоятельно информацию.
3.
создать обычного пользователя и добавить его в судо
нужное действие есть в методичке.

по пунктам команды текстом.
где команд нет, но нужно показать действие, присылаем скриншот.